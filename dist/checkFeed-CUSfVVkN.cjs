"use strict";async function T(e,t=5e3){const n=new AbortController,r=n.signal,s=setTimeout(()=>n.abort(),t),c={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Language":"en-US,en;q=0.5","Accept-Encoding":"gzip, deflate, br",Connection:"keep-alive","Upgrade-Insecure-Requests":"1","Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"none","Cache-Control":"max-age=0"};try{const l=await fetch(e,{signal:r,headers:c});return clearTimeout(s),l}catch(l){throw clearTimeout(s),l}}const i={CDATA:/<!\[CDATA\[(.*?)\]\]>/g,RSS:{VERSION:/<rss[^>]*\s+version\s*=\s*["'][\d.]+["'][^>]*>/i,CHANNEL:/<channel[^>]*>/i,ITEM:/<item[^>]*>/i,DESCRIPTION:/<description[^>]*>/i,CHANNEL_END:/<\/channel>/i,CHANNEL_CONTENT:/<channel>([\s\S]*?)<\/channel>/i,TITLE:/<title>([\s\S]*?)<\/title>/i},ATOM:{FEED_START:/<feed(?:\s+[^>]*)?>/i,NAMESPACE_XMLNS:/<feed[^>]*xmlns[^>]*atom/i,NAMESPACE_XMLNS_ATOM:/<feed[^>]*xmlns:atom/i,NAMESPACE_ATOM_PREFIX:/<feed[^>]*atom:/i,ENTRY:/<entry[^>]*>/i,TITLE_TAG:/<title[^>]*>/i,TITLE_CONTENT:/<title>([\s\S]*?)<\/title>/i}};function a(e){return e.replace(i.CDATA,"$1")}function o(e){return e&&e.replace(/\s+/g," ").trim()}async function u(e,t="",n){if(e.includes("/wp-json/oembed/")||e.includes("/oembed"))return null;if(!t){const s=await T(e,n.options.timeout*1e3);if(!s.ok)throw new Error(`Failed to fetch ${e}: ${s.status} ${s.statusText}`);t=await s.text()}return E(t)||S(t)||h(t)||null}function A(e){const t=i.RSS.CHANNEL_CONTENT.exec(e);if(t){const s=t[1],c=i.RSS.TITLE.exec(s);return c?o(a(c[1])):null}const n=i.RSS.TITLE.exec(e);return n?o(a(n[1])):null}function E(e){if(i.RSS.VERSION.test(e)){const t=i.RSS.CHANNEL.test(e),n=i.RSS.ITEM.test(e),r=i.RSS.DESCRIPTION.test(e);if(t&&r&&(n||i.RSS.CHANNEL_END.test(e)))return{type:"rss",title:A(e)}}return null}function S(e){const t=i.ATOM.NAMESPACE_XMLNS.test(e)||i.ATOM.NAMESPACE_XMLNS_ATOM.test(e)||i.ATOM.NAMESPACE_ATOM_PREFIX.test(e);if(i.ATOM.FEED_START.test(e)&&t){const n=i.ATOM.ENTRY.test(e),r=i.ATOM.TITLE_TAG.test(e);if(n&&r){const s=i.ATOM.TITLE_CONTENT.exec(e);return{type:"atom",title:s?o(a(s[1])):null}}}return null}function h(e){try{const t=JSON.parse(e);if(t.type&&["rich","video","photo","link"].includes(t.type)&&(t.version==="1.0"||t.version==="2.0")||t.type&&t.version&&t.html)return null;if(t.version&&typeof t.version=="string"&&t.version.includes("jsonfeed")||t.items&&Array.isArray(t.items)||t.feed_url){const n=t.title||t.name||null;return{type:"json",title:o(n)}}return null}catch{return null}}exports.checkFeed=u;exports.fetchWithTimeout=T;
