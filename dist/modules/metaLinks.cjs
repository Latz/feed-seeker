"use strict";const a=require("../checkFeed-DOTZWUmC.cjs");function d(e){return e&&e.replace(/\s+/g," ").trim()}async function c(e){e.emit("start",{module:"metalinks",niceName:"Meta links"});let l=[];const i=e.options?.maxFeeds||0,m=["feed+json","rss+xml","atom+xml","xml","rdf+xml"];for(const r of m){e.emit("log",{module:"metalinks",feedType:r});for(let o of e.document.querySelectorAll(`link[type="application/${r}"]`)){const s=new URL(o.href,e.site).href;try{const t=await a.checkFeed(s);if(t&&(l.push({url:s,title:d(o.title),type:t.type,feedTitle:t.title}),i>0&&l.length>=i))return e.emit("log",{module:"metalinks",message:`Stopped due to reaching maximum feeds limit: ${l.length} feeds found (max ${i} allowed).`}),l}catch(t){e.emit("error",{module:"metalinks",error:t.message})}}}const f=e.document.querySelectorAll('link[rel="alternate"][type*="rss"], link[rel="alternate"][type*="xml"], link[rel="alternate"][type*="atom"], link[rel="alternate"][type*="json"]');for(let r of f){const o=new URL(r.href,e.site).href;if(!l.some(t=>t.url===o))try{const t=await a.checkFeed(o);if(t&&(l.push({url:o,title:d(r.title),type:t.type,feedTitle:t.title}),i>0&&l.length>=i))return e.emit("log",{module:"metalinks",message:`Stopped due to reaching maximum feeds limit: ${l.length} feeds found (max ${i} allowed).`}),l}catch(t){e.emit("error",{module:"metalinks",error:t.message,explanation:"An error occurred while trying to fetch and validate a feed URL found in an alternate meta link. This could be due to network issues, server problems, or invalid feed content.",suggestion:"Check if the alternate link URL is accessible and returns valid feed content. The search will continue with other meta links."})}}const u=e.document.querySelectorAll('link[rel="alternate"]');for(let r of u){const o=["/rss","/feed","/atom",".rss",".atom",".xml",".json"];if(r.href&&o.some(t=>r.href.toLowerCase().includes(t))){const t=new URL(r.href,e.site).href;if(!l.some(n=>n.url===t))try{const n=await a.checkFeed(t);if(n&&(l.push({url:t,title:d(r.title),type:n.type,feedTitle:n.title}),i>0&&l.length>=i))return e.emit("log",{module:"metalinks",message:`Stopped due to reaching maximum feeds limit: ${l.length} feeds found (max ${i} allowed).`}),l}catch(n){e.emit("error",{module:"metalinks",error:n.message,explanation:"An error occurred while trying to fetch and validate a feed URL found in a meta link tag. This could be due to network issues, server problems, or invalid feed content.",suggestion:"Check if the meta link URL is accessible and returns valid feed content. The search will continue with other meta links."})}}}return e.emit("end",{module:"metalinks",feeds:l}),l}module.exports=c;
