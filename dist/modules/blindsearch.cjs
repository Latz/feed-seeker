"use strict";const m=require("../checkFeed-CUSfVVkN.cjs"),u=["&_rss=1",".atom",".json",".rss",".xml","atom","atom.xml","atom/index.xml","feed","feed.atom","feed.json","feed.rss","feed.xml","feeds","feeds/","index.atom","index.rss","index.xml","rss","rss/","rss.xml","rss/index.xml","rss/news/rss.xml","rss/rss.php","rssfeed.rdf","rssfeed.xml","syndication/","blog-feed.xml","blog/atom","blog/feed","blog/feeds","blog/rss","blog?format=rss","weblog/atom","weblog/rss","?feed=atom","?feed=rss2","?format=feed","feed/atom/","feed/rdf/","feed/rss/","feed/rss2/","index.php?format=feed","wp-atom.php","wp-feed.php","wp-rdf.php","wp-rss.php","wp-rss2.php","articles/feed","atom/news/","latest.rss","latest/feed","news.xml","news/atom","news/rss","rss/articles/","rss/latest/","rss/news/","catalog.xml","catalog/feed","deals.xml","deals/feed","inventory.rss","inventory/feed","products.rss","products/atom","products/rss","promotions/feed","specials/feed","audio/feed","episodes.rss","episodes/feed","gallery.rss","media/feed","podcast.rss","podcast/atom","podcast/rss","podcasts/feed","shows/feed","video/feed","videos.rss","comments/feed","community/feed","discussions/feed","forum.rss","forum/atom","forum/rss","reviews/feed","agenda/feed","calendar/feed","events.rss","events/feed","schedule/feed","careers/feed","jobs.rss","jobs/feed","opportunities/feed","vacancies/feed","content/feed","documents/feed","pages/feed","resources/feed","emails/feed","mailinglist/feed","newsletter/feed","subscription/feed","atomfeed","jsonfeed","newsfeed","rssfeed","api/atom","api/feed","api/mobile/feed","api/rss","api/rss.xml","api/v1/feed","api/v2/feed","v1/feed","v2/feed",".opml",".rdf","opml","opml/","rdf","rdf/","category/*/feed","tag/*/feed","tags/feed","topics/feed","author/*/feed","profile/*/feed","user/*/feed","archive/feed","daily/feed","monthly/feed","weekly/feed","yearly/feed","announcements/feed","changelog/feed","press/feed","releases/feed","revisions/feed","updates/feed","app/feed","mobile/feed","international/feed","local/feed","national/feed","regional/feed","education/feed","entertainment/feed","finance/feed","health/feed","industry/feed","market/feed","science/feed","sector/feed","sports/feed","technology/feed","aggregate/feed","all/feed","combined/feed","compilation/feed","everything/feed","actualites/feed","nachrichten/feed","nieuws/feed","noticias/feed","novosti/feed","?atom=1","?download=atom","?download=rss","?export=atom","?export=rss","?feed=atom","?feed=rss","?format=atom","?format=feed","?format=rss","?output=atom","?output=rss","?rss=1","?syndicate=atom","?syndicate=rss","?type=atom","?type=rss","?view=feed","?view=rss","export/rss.xml","extern.php?action=feed&type=atom","external?type=rss2","feed.aspx","feed.cml","feed/atom","feed/atom.rss","feed/atom.xml","feed/rdf","feed/rss.xml","feed/rss2","index.php?action=.xml;type=rss","posts.rss","public/feed.xml","rss.aspx","rss.cfm","rss.php","sitenews","spip.php?page=backend","spip.php?page=backend-breve","spip.php?page=backend-sites","syndicate/rss.xml","syndication.php","xml","feed.jsp","feed.php","feed.pl","feed.py","feed.rb","feeds.json","feeds.php","feeds.xml","_site/feed.xml","build/feed.xml","dist/feed.xml","out/feed.xml","api/feed.xml","cms/feed","contentful/feed","sanity/feed","strapi/feed","docs/feed","documentation/feed","help/feed","kb/feed","support/feed","wiki/feed","branches/feed","commits/feed","issues/feed","pull-requests/feed","releases/feed","tags/feed","analytics/feed","metrics/feed","reports/feed","stats/feed","de/feed","en/feed","es/feed","fr/feed","it/feed","ja/feed","ko/feed","pt/feed","ru/feed","zh/feed","feed.csv","feed.txt","feed.yaml","feed.yml","drupal/feed","joomla/feed","magento/feed","opencart/feed","prestashop/feed","shopify/feed","typo3/feed","woocommerce/feed","discourse/feed","invision/feed","phpbb/feed","vbulletin/feed","xenforo/feed"];function h(e,f){const d=new URL(e).origin;let t=e;const s=[];let a="";for(f&&(a=new URL(e).search);t.length>=d.length;){const o=t.endsWith("/")?t.slice(0,-1):t;u.forEach(r=>{const n=a?`${o}/${r}${a}`:`${o}/${r}`;s.push(n)}),t=t.slice(0,t.lastIndexOf("/"))}return s}function g(e,f,d,t,s){return e.type==="rss"?t=!0:e.type==="atom"&&(s=!0),d.push({url:f,feedType:e.type,title:e.title,type:e.type,feedTitle:e.title}),{rssFound:t,atomFound:s}}function x(e,f,d,t,s){return e<f&&!(!s&&d&&t)}async function y(e){const f=h(e.site,e.options?.keepQueryParams||!1);e.emit("start",{module:"blindsearch",niceName:"Blind search",endpointUrls:f.length});const d=e.options?.all||!1,t=e.options?.maxFeeds||0,s=await w(f,d,t,e);return e.emit("end",{module:"blindsearch",feeds:s.feeds}),s.feeds}async function w(e,f,d,t){const s=[],a=new Set;let o=!1,r=!1,n=0;for(;x(n,e.length,o,r,f);){if(d>0&&s.length>=d){await l(t,s,d);break}const p=e[n],i=await b(p,t,a,s,o,r);if(i.found&&(o=i.rssFound,r=i.atomFound,d>0&&s.length>=d)){await l(t,s,d);break}let c=s.length;t.emit("log",{module:"blindsearch",totalEndpoints:e.length,totalCount:n,feedsFound:c}),n++}return{feeds:s,rssFound:o,atomFound:r}}async function b(e,f,d,t,s,a){try{const o=await m.checkFeed(e,"",f);if(o&&!d.has(e)){d.add(e);const r=g(o,e,t,s,a);return s=r.rssFound,a=r.atomFound,{found:!0,rssFound:s,atomFound:a}}}catch(o){const r=o instanceof Error?o:new Error(String(o));await v(f,e,r)}return{found:!1,rssFound:s,atomFound:a}}async function l(e,f,d){e.emit("log",{module:"blindsearch",message:`Stopped due to reaching maximum feeds limit: ${f.length} feeds found (max ${d} allowed).`})}async function v(e,f,d){e.options?.showErrors&&e.emit("error",{module:"blindsearch",error:`Error fetching ${f}: ${d.message}`,explanation:"An error occurred while trying to fetch a potential feed URL during blind search. This could be due to network timeouts, server errors, 404 not found, or invalid content.",suggestion:"This is normal during blind search as many URLs are tested. The search will continue with other potential feed endpoints."})}module.exports=y;
