"use strict";class n{#e=new Map;#r;#i;static#n=10;constructor(e={}){this.#r=e.maxListeners??n.#n,this.#i=e.captureAsyncErrors??!0}static setDefaultMaxListeners(e){if(typeof e!="number"||e<0||!Number.isInteger(e))throw new TypeError("Max listeners must be a non-negative integer");n.#n=e}#t(e){if(typeof e!="string"||e.trim().length===0)throw new TypeError("Event must be a non-empty string")}#s(e){if(typeof e!="function")throw new TypeError("Listener must be a function")}#o(e){if(this.#r>0){const r=this.listenerCount(e);r>this.#r&&console.warn(`Warning: Possible EventEmitter memory leak detected. ${r} ${e} listeners added. Use emitter.setMaxListeners() to increase limit`)}}#h(e,r){if(r==="error")throw console.error("Error in error event listener:",e),e;const t=this.#e.get("error");if(t&&t.size>0)this.emit("error",e,r);else throw console.error(`Unhandled error in event listener for '${r}':`,e),e}on(e,r){this.#t(e),this.#s(r);const t=this.#e.get(e);return t?t.add(r):this.#e.set(e,new Set([r])),this.#o(e),this}prependListener(e,r){this.#t(e),this.#s(r);const t=this.#e.get(e);if(!t)this.#e.set(e,new Set([r]));else{const s=new Set([r,...t]);this.#e.set(e,s)}return this.#o(e),this}once(e,r){this.#t(e),this.#s(r);const t=((...s)=>{this.off(e,t),r(...s)});return t.originalListener=r,this.on(e,t)}prependOnceListener(e,r){this.#t(e),this.#s(r);const t=((...s)=>{this.off(e,t),r(...s)});return t.originalListener=r,this.prependListener(e,t)}emit(e,...r){const t=this.#e.get(e);if(!t||t.size===0){if(e==="error"){const s=r[0];throw s instanceof Error?s:new Error(`Unhandled error event: ${String(s)}`)}return!1}return[...t].forEach(s=>{try{const i=s(...r);this.#i&&i instanceof Promise&&i.catch(o=>{this.#h(o,e)})}catch(i){this.#h(i,e)}}),!0}off(e,r){const t=this.#e.get(e);return t?([...t].forEach(s=>{(s===r||s.originalListener===r)&&t.delete(s)}),t.size===0&&this.#e.delete(e),this):this}removeAllListeners(e){return e?(this.#t(e),this.#e.delete(e)):this.#e.clear(),this}setMaxListeners(e){if(typeof e!="number"||e<0||!Number.isInteger(e))throw new TypeError("Max listeners must be a non-negative integer");return this.#r=e,this}getMaxListeners(){return this.#r}listenerCount(e){const r=this.#e.get(e);return r?r.size:0}listeners(e){const r=this.#e.get(e);return r?[...r].map(t=>t.originalListener||t):[]}rawListeners(e){const r=this.#e.get(e);return r?[...r]:[]}eventNames(){return Array.from(this.#e.keys())}}module.exports=n;
