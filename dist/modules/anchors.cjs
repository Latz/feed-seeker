"use strict";var f=Object.create;var u=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty;var b=(e,r,t,s)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of p(r))!y.call(e,o)&&o!==t&&u(e,o,{get:()=>r[o],enumerable:!(s=m(r,o))||s.enumerable});return e};var U=(e,r,t)=>(t=e!=null?f(g(e)):{},b(r||!e||!e.__esModule?u(t,"default",{value:e,enumerable:!0}):t,e));const w=require("../checkFeed-DOTZWUmC.cjs"),v=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"}));function c(e,r){try{return new URL(e,r)}catch{return null}}function R(e){const r=c(e);return r?r.protocol==="http:"||r.protocol==="https:":!1}function k(e){return c(e)?!1:!e.includes("://")}function x(e,r){const t=c(e);if(!t||t.hostname===r.hostname)return!0;const s=["feedburner.com","feeds.feedburner.com","feedproxy.google.com","feeds2.feedburner.com"];return s.includes(t.hostname)||s.some(o=>t.hostname.endsWith("."+o))}async function L(e){const r=e.document.querySelector('meta[http-equiv="refresh"]')?.getAttribute("content");if(r&&r.toLowerCase().includes("url=")){const t=r.match(/url=(?:["']?)([^"';,\s]+)(?:["']?)/i);if(t&&t[1]){const s=t[1].trim();if(!s){e.emit("error",{module:"anchors",error:"Meta refresh redirect URL is empty",explanation:"The meta refresh tag contains an empty URL parameter. This usually indicates malformed HTML or a website configuration error.",suggestion:`Check the website's HTML source for proper meta refresh syntax: <meta http-equiv="refresh" content="0;url=https://example.com">`});return}const o=c(s,e.site);if(!o){e.emit("error",{module:"anchors",error:`Invalid meta refresh redirect URL: ${s}`,explanation:"The URL found in the meta refresh tag could not be parsed or resolved. This may be due to malformed URL syntax, unsupported protocol, or invalid characters.",suggestion:"Verify the URL format is correct and uses http:// or https:// protocol. Check for special characters that may need encoding."});return}if(o.href===e.site){e.emit("error",{module:"anchors",error:`Meta refresh redirect would create infinite loop: ${o.href}`,explanation:"The meta refresh tag redirects to the same URL that is currently being processed. This would cause an infinite loop of redirects.",suggestion:"This is likely a website configuration error. The meta refresh should redirect to a different URL, not back to itself."});return}e.site=o.href;const{default:i}=await Promise.resolve().then(()=>v(require("./fetchWithTimeout.cjs"))),{parseHTML:n}=await import("linkedom");try{const a=await i(o.href);if(a){const l=await a.text(),{document:d}=n(l);e.document=d}}catch(a){e.emit("error",{module:"anchors",error:`Failed to follow meta refresh redirect to ${o.href}: ${a.message}`,explanation:"An error occurred while trying to fetch the redirected page. This could be due to network issues, server problems, or the target URL being inaccessible.",suggestion:"Check if the redirect URL is accessible in a browser. The original page will be processed instead of the redirect target."})}}}}function h(e,r,t){if(!e.href)return null;if(R(e.href))return e.href;if(k(e.href)){const s=c(e.href,r);return s?s.href:(t.emit("error",{module:"anchors",error:`Invalid relative URL: ${e.href}`,explanation:"A relative URL found in an anchor tag could not be resolved against the base URL. This may be due to malformed relative path syntax.",suggestion:'Check the anchor href attribute for proper relative path format (e.g., "./feed.xml", "../rss.xml", or "/feed").'}),null)}return null}async function T(e,r){const{instance:t,baseUrl:s,feedUrls:o}=r,i=h(e,s,t);if(i){t.emit("log",{module:"anchors",anchor:i});try{const n=await w.checkFeed(i);n&&o.push({href:i,title:e.textContent?.trim()||null,type:n.type,feedTitle:n.title})}catch(n){t.emit("error",{module:"anchors",error:`Error checking feed at ${i}: ${n.message}`,explanation:"An error occurred while trying to fetch and validate a potential feed URL found in an anchor tag. This could be due to network timeouts, server errors, or invalid feed content.",suggestion:"Check if the URL is accessible and returns valid feed content. Network connectivity issues or server problems may cause this error."})}}}async function A(e){await L(e);const r=new URL(e.site),t=e.document.querySelectorAll("a"),s=[];let o=0;for(const a of t){o++;const l=h(a,r,e);l&&x(l,r)&&s.push(a)}const i=e.options?.maxFeeds||0,n={instance:e,baseUrl:r,feedUrls:[]};e.emit("log",{module:"anchors",totalCount:o,filteredCount:s.length});for(const a of s){if(i>0&&n.feedUrls.length>=i){e.emit("log",{module:"anchors",message:`Stopped due to reaching maximum feeds limit: ${n.feedUrls.length} feeds found (max ${i} allowed).`});break}await T(a,n)}return n.feedUrls}async function C(e){e.emit("start",{module:"checkAllAnchors",niceName:"Check all anchors"});const r=await A(e);return e.emit("end",{module:"checkAllAnchors",feeds:r}),r}module.exports=C;
