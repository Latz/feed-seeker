#!/usr/bin/env node
"use strict";const e=require("linkedom"),s=require("./modules/metaLinks.cjs"),n=require("./modules/anchors.cjs"),r=require("./modules/blindsearch.cjs"),o=require("./modules/deepSearch.cjs"),c=require("./modules/eventEmitter.cjs"),h=require("./modules/fetchWithTimeout.cjs");class a extends c{constructor(i,t={}){super(),i.includes("://")||(i=`https://${i}`),this.site=new URL(i).href,this.options=t,this.initPromise=null}async initialize(){return this.initPromise===null&&(this.initPromise=(async()=>{try{const i=await h(this.site);if(!i){this.emit("error",`Failed to fetch ${this.site}`),this.content="",this.document={querySelectorAll:()=>[]},this.emit("initialized");return}this.content=await i.text();const{document:t}=e.parseHTML(this.content);this.document=t,this.emit("initialized")}catch(i){this.emit(`Error fetching ${this.site}:`,i),this.content="",this.document={querySelectorAll:()=>[]},this.emit("initialized")}})()),this.initPromise}async metaLinks(){return await this.initialize(),s(this)}async checkAllAnchors(){return await this.initialize(),n(this)}async blindSearch(){return await this.initialize(),r(this)}async deepSearch(){return await this.initialize(),o(this.site,this.options,this)}}module.exports=a;
