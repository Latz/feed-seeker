"use strict";const s={CDATA:/<!\[CDATA\[(.*?)\]\]>/g,RSS:{VERSION:/<rss[^>]*\s+version\s*=\s*["'][\d.]+["'][^>]*>/i,CHANNEL:/<channel[^>]*>/i,ITEM:/<item[^>]*>/i,DESCRIPTION:/<description[^>]*>/i,CHANNEL_END:/<\/channel>/i,CHANNEL_CONTENT:/<channel>([\s\S]*?)<\/channel>/i,TITLE:/<title>([\s\S]*?)<\/title>/i},ATOM:{FEED_START:/<feed(?:\s+[^>]*)?>/i,NAMESPACE_XMLNS:/<feed[^>]*xmlns[^>]*atom/i,NAMESPACE_XMLNS_ATOM:/<feed[^>]*xmlns:atom/i,NAMESPACE_ATOM_PREFIX:/<feed[^>]*atom:/i,ENTRY:/<entry[^>]*>/i,TITLE_TAG:/<title[^>]*>/i,TITLE_CONTENT:/<title>([\s\S]*?)<\/title>/i}};function c(e){return e.replace(s.CDATA,"$1")}function l(e){return e&&e.replace(/\s+/g," ").trim()}async function E(e,t=""){if(e.includes("/wp-json/oembed/")||e.includes("/oembed"))return null;if(!t){const n=await fetch(e);if(!n.ok)throw new Error(`Failed to fetch ${e}: ${n.status} ${n.statusText}`);t=await n.text()}return o(t)||u(t)||N(t)||null}function A(e){const t=s.RSS.CHANNEL_CONTENT.exec(e);if(t){const r=t[1],T=s.RSS.TITLE.exec(r);return T?l(c(T[1])):null}const i=s.RSS.TITLE.exec(e);return i?l(c(i[1])):null}function o(e){if(s.RSS.VERSION.test(e)){const t=s.RSS.CHANNEL.test(e),i=s.RSS.ITEM.test(e),n=s.RSS.DESCRIPTION.test(e);if(t&&n&&(i||s.RSS.CHANNEL_END.test(e)))return{type:"rss",title:A(e)}}return null}function u(e){const t=s.ATOM.NAMESPACE_XMLNS.test(e)||s.ATOM.NAMESPACE_XMLNS_ATOM.test(e)||s.ATOM.NAMESPACE_ATOM_PREFIX.test(e);if(s.ATOM.FEED_START.test(e)&&t){const i=s.ATOM.ENTRY.test(e),n=s.ATOM.TITLE_TAG.test(e);if(i&&n){const r=s.ATOM.TITLE_CONTENT.exec(e);return{type:"atom",title:r?l(c(r[1])):null}}}return null}function N(e){try{const t=JSON.parse(e);if(t.type&&["rich","video","photo","link"].includes(t.type)&&(t.version==="1.0"||t.version==="2.0")||t.type&&t.version&&t.html)return null;if(t.version&&typeof t.version=="string"&&t.version.includes("jsonfeed")||t.items&&Array.isArray(t.items)||t.feed_url){const i=t.title||t.name||null;return{type:"json",title:l(i)}}return null}catch{return null}}exports.checkFeed=E;
